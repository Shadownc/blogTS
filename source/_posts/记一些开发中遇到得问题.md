---
title: 记一些开发中遇到得问题...
date: 2018-06-15 15:36:11
categories:
- JavaScript
tags:
- JavaScript
---
平时开发中遇到的一些问题及解决方法
<!-- more -->
##### onclick事件传递对象参数
```JavaScript
onclick="todo("+JSON.stringify(data).replace(/"/g, '&quot;')+")"
demo:
<a class="fc-check" onclick="goDetail('+JSON.stringify(fcOrderList[i].orderId).replace(/"/g, '&quot;')+')">查看</a>//传递单个参数 单引号拼接
"<td width=\"120\"><a class=\"fc-check\" onclick=\"todo("+JSON.stringify(data).replace(/"/g, '&quot;')+")\">查看</a></td>"//双引号拼接 传递对象参数--需要用\(反斜杠)转义
```
##### ajax post方法参数问题
```JavaScript
let obj={};
obj.gameName='xxx';
obj.gameId='xxx';
$.ajax({
            type: "POST",
            url: url+ "?t=" + new Date().getTime(),
            data: JSON.stringify(obj),
            contentType: "application/json; charset=UTF-8",
            dataType: "json",
            success: function (res) {
               console.log(res)
        });
//使用contentType: “application/json”则data只能是json字符串
```
##### switch(data){}
```JavaScript
switch(data){
  case '1':
      console.log(11);
      break;
case 2:
    console.log(22);
    break;
}
//switch对参数类型敏感 可以先打印看看data到底是什么类型的参数 console.log(typeof data);
//如果参数data=1是字符串可以打印出11，但是如果1是number那么就不会去执行case1下面得了
```
##### [WdatePicker.js](https://blog.csdn.net/nnn_net/article/details/50340929)使用
```JavaScript
//代码如下：
<input id="startTime" class="Wdate m-letf3" readonly="readonly" type="text" onFocus="WdatePicker({ dateFmt: 'yyyy-MM-dd HH:mm:ss',maxDate:'#F{$dp.$D(\'endTime\',{d:-7})}'})"/>
<input id="endTime" class="Wdate" readonly="readonly" type="text" onFocus="WdatePicker({ dateFmt: 'yyyy-MM-dd HH:mm:ss' ,minDate:'#F{$dp.$D(\'startTime\')}',maxDate:'#F{$dp.$D(\'startTime\',{d:7})}'})"/>
//显示年月日时分秒:onFocus="WdatePicker({ dateFmt: 'yyyy-MM-dd HH:mm:ss'})"
//结束时间为开始时间七天以内:startTime--maxDate:'#F{$dp.$D(\'endTime\',{d:-7})}'
// endTime--minDate:'#F{$dp.$D(\'startTime\')}',maxDate:'#F{$dp.$D(\'startTime\',{d:7})}'
```
##### 使用toFixed()函数时，出现“toFixed() is not a function”的解决办法
```JavaScript
typeof item.price//string
//toFixed只能针对数字类型才能使用，所以对于字符类型的要用parseFloat或者parseInt函数先转一下再调用
parseInt(item.price).toFixed(2)//item.price=34.000 -- 34.00
```
###### js获取当前时间的前一天/后一天
```JavaScript
var now=new Date();
var preDate = new Date(now.getTime() - 24*60*60*1000); //前一天
var nextDate = new Date(now.getTime() + 24*60*60*1000); //后一天
```
##### try catch
```JavaScript
//背景--url跳转中文参数编码，由于未登录先去登录站点登录，进行了二次编码，导致获取url中文参数乱码问题
try {
    tryCode - 尝试执行代码块
}
catch(err) {
    catchCode - 捕获错误的代码块
} 
finally {
    finallyCode - 无论 try / catch 结果如何都会执行的代码块
}
//demo
// 获取URL对应参数值
function getUrlParam(name){
    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
    var r = window.location.search.substr(1).match(reg);  //匹配目标参数
    if (r!=null){
        try {
            return decodeURI(r[2]); //报错执行catch下得代码
        }catch(e){
            return unescape(r[2])
        }
    }else{
        return null; //返回参数值
    } 
}
```
##### 限制input输入数字且小数点后最多n位
```JavaScript
function num(value,length) {
    //length代表可以输入得小数位数
    value = value.replace(/[^\d.]/g, "");  //清除“数字”和“.”以外的字符
    value = value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
    value = value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
    var str='^(\\-)*(\\d+)\\.([0-9]{1,'+length+'}).*$';//给正则表达式代入动态参数 ，注意--反斜杠需要转义
    var reg=new RegExp(str);
    value = value.replace(reg,'$1$2.$3');//只能输入两个小数-- reg=/^(\-)*(\d+)\.([0-9]{1,2}).*$/
    if (value.indexOf(".") < 0 && value != "") {//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额
       value = parseFloat(value);
    }
    return value
}
//使用：如果小数后面五位则num(this.value,5)
<input placeholder="" onkeyup="this.value=num(this.value,2)" />
```
##### 测试环境线上环境接口域名不同
```JavaScript
#获取协议 域名端口 拼接请求url
`${location.protocol}//${location.host}`
`${location.protocol}//${location.host}/api/getInfo`
```
##### js返回上一页并刷新页面
```JavaScript
//<a href="#" onclick="self.location=document.referrer;">返回</a>
self.location=document.referrer
```